models:
  - name: user_sessions
    description: "Full coverage for session integrity, freshness and behavioral analytics"

    sample:
      method: random
      size: 3
      partitioned_by: session_date
      partition_strategy: latest
      partition_count: 2

    qc2plus_tests:
      level1:
        # ğŸ†” 1. UnicitÃ© de session_id
        - unique:
            column_name: session_id
            severity: critical

        # ğŸ‘¤ 2. user_id obligatoire
        - not_null:
            column_name: user_id
            severity: critical

        # ğŸ“… 3. Dates futures interdites
        - future_date:
            column_name: session_date
            severity: high

        # ğŸ“Š 4. Nombre de pages vues valide
        - range_check:
            column_name: page_views
            min_value: 1
            max_value: 200
            severity: medium

        # â³ 5. DonnÃ©es fraÃ®ches
        - freshness:
            column_name: session_date
            max_age_days: 3
            severity: critical

        # ğŸ§© 6. Custom SQL : dÃ©tecter les sessions "anormales" (> 80 pages vues)
        - custom_sql:
            custom_sql: |
              SELECT 
                'page_views_outlier' AS column_name,
                COUNT(*) AS failed_rows,
                (SELECT COUNT(*) FROM demo.user_sessions) AS total_rows,
                'Sessions with abnormally high page_views (> 80)' AS message
              FROM demo.user_sessions
              WHERE page_views > 80
              HAVING COUNT(*) > 0
            severity: medium

      level2:
        # ğŸ“ˆ 1. Analyse temporelle (tendances et anomalies)
        - temporal_analysis:
            date_column: session_date
            metrics: [count, sum_page_views]
            anomaly_detection: true
            seasonality_check: false
            window_days: 7
            frequency: daily
            severity: medium

        # ğŸ“Š 2. Analyse de distribution : concentration dâ€™activitÃ© par utilisateur
        - distribution_analysis:
            segments: [user_id]
            metrics: [count, sum_page_views]
            date_column: session_date
            reference_period: 7
            comparison_period: 2
            behavior_change_threshold: 100
            severity: medium

        # ğŸ§® 3. CorrÃ©lation entre nombre de pages vues et activitÃ© journaliÃ¨re
        - correlation_analysis:
            variables: [page_views, session_date]
            expected_correlation: 0.0
            threshold: 0.5
            severity: low
