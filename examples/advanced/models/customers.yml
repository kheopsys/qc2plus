models:
  - name: customers
    description: "Comprehensive data quality plan for the customers model"
    
    sample:
      method: random
      percentage: 0.2
      partitioned_by: created_at
      partition_strategy: latest

    qc2plus_tests:
      level1:
        # ðŸ§± 1. Uniqueness test â€” IDs should be unique
        - unique:
            column_name: customer_id
            severity: critical
            sample: null

        # ðŸ§© 2. Email format check â€” regex validation
        - email_format:
            column_name: email
            severity: high

        # ðŸ”¢ 3. Age validity â€” ensure realistic values
        - range_check:
            column_name: age
            min_value: 18
            max_value: 120
            severity: medium

        # ðŸ§¾ 4. Not null checks â€” key business columns
        - not_null:
            column_name: email
            severity: critical
        - not_null:
            column_name: country
            severity: high
        - not_null:
            column_name: created_at
            severity: medium

        # ðŸ“… 5. Future date detection â€” invalid timestamps
        - future_date:
            column_name: created_at
            severity: medium

        # ðŸ•“ 6. Freshness check â€” ensure recent data
        - freshness:
            column_name: created_at
            max_age_days: 30
            severity: high

        # ðŸŽ¯ 7. Accepted values â€” for status field
        - accepted_values:
            column_name: status
            accepted_values: ['active', 'inactive']
            severity: critical

        # ðŸŒ 8. Accepted values â€” for country field (sample domain)
        - accepted_values:
            column_name: country
            accepted_values: ['USA', 'UK', 'Canada']
            severity: medium

        # âš–ï¸ 9. Statistical threshold â€” number of new customers per day
        - statistical_threshold:
            metric: count
            threshold_type: relative
            threshold_value: 2.0
            window_days: 30
            severity: medium

        # ðŸ’° 10. Custom SQL â€” too many inactive users (>10%)
        - custom_sql:
            custom_sql: |
              SELECT 
                'inactive_ratio_limit' AS column_name,
                COUNT(*) AS failed_rows,
                (SELECT COUNT(*) FROM demo.customers) AS total_rows,
                'Inactive users exceed 10%' AS message
              FROM demo.customers
              WHERE status = 'inactive'
              HAVING COUNT(*) > 0.1 * (SELECT COUNT(*) FROM demo.customers)
            severity: high

      level2:
        # ðŸ“Š 1. Distribution analysis â€” evolution by country and status
        - distribution_analysis:
            segments: [country, status]
            metrics: [count]
            date_column: created_at
            reference_period: 30
            comparison_period: 7
            behavior_change_threshold: 80
            severity: medium

        # ðŸ“ˆ 2. Temporal analysis â€” signups trend
        - temporal_analysis:
            date_column: created_at
            metrics: [count]
            seasonality_check: true
            anomaly_detection: true
            window_days: 30
            frequency: daily
            severity: medium

        # ðŸ§® 3. Correlation analysis â€” age vs signup recency
        - correlation_analysis:
            variables: [age, created_at]
            expected_correlation: 0.0
            threshold: 0.4
            severity: low
