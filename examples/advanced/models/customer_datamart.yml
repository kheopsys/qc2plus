models:
  - name: customer_datamart
    description: "Advanced Level 1 + Level 2 ML tests"
    qc2plus_tests:
      level1:
        - unique:
            column_name: customer_id
            severity: critical
        - range_check:
            column_name: lifetime_value
            min_value: 0
            max_value: 1000000
            severity: medium
        - range_check:
            column_name: order_frequency
            min_value: 1
            severity: medium
        - accepted_values:
            column_name: customer_segment
            accepted_values: ['Mono-buyer', 'Regular-buyer', 'VIP-buyer']
            severity: critical
        - accepted_benchmark_values:
            column_name: customer_segment
            benchmark_values:
              'Mono-buyer': 50      
              'Regular-buyer': 40    
              'VIP-buyer': 10       
            threshold: 0.2          
            severity: critical

        - custom_sql:
            custom_sql: |
              SELECT 
                'vip_buyer_limit' as column_name,
                COUNT(*) as failed_rows,
                (SELECT COUNT(*) FROM demo.customer_datamart) as total_rows,
                'Too many VIP buyers' as message
                  FROM demo.customer_datamart 
                  WHERE customer_segment = 'VIP-buyer'
                  HAVING COUNT(*) > 5
            severity: medium
      level2:
        correlation_analysis:
          variables: [lifetime_value, order_frequency,customer_id]
          expected_correlation: 0.7
          threshold: 0.3


# garder en tete que la quality doit pourvoir s'appliquer sur une table partitionn√©e pour quelques partitions uniquement
